# Implementation Plan: Pet Store

**Branch**: `001-pet-store` | **Date**: 2026-03-01 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/001-pet-store/spec.md`

## Summary

Build an Akka-based pet store service with pet lifecycle management (Event Sourced Entity), shopping cart (Key Value Entity), adoption workflow (Workflow with compensation), available pets catalog (View), and AI recommendation assistant (Agent with function tools). All functionality exposed via HTTP endpoints. Web UI deferred to a future iteration.

## Technical Context

**Language/Version**: Java 21+ (records, sealed interfaces)
**Primary Dependencies**: Akka SDK 3.5.14 (parent POM `akka-javasdk-parent`)
**Storage**: Akka managed (event journal for ESE, state store for KVE, workflow state)
**Testing**: JUnit 5, AssertJ, Awaitility, Akka TestKit (`EventSourcedTestKit`, `KeyValueEntityTestKit`, `TestKitSupport`, `TestModelProvider`)
**Target Platform**: JVM / Akka Cloud or local
**Project Type**: Web service (Akka microservice)
**Performance Goals**: Catalog queries < 2s, cart operations < 1s, AI responses < 15s
**Constraints**: Concurrent adoption safety (first-wins), valid pet state machine enforcement
**Scale/Scope**: Single service, 5 active user stories (US6 web UI deferred), 5 Akka components + 4 HTTP endpoints

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Domain Design | PASS | Domain records (Pet, ShoppingCart, Adoption) in `domain` package. Business logic in domain objects. Events as sealed interfaces with `@TypeName`. |
| II. Incremental Generation Workflow | PASS | Components built one at a time: PetEntity → PetEntity tests → View → View tests → Cart → Cart tests → Workflow → Workflow tests → Agent → Agent tests → Endpoints → Integration tests → Web UI. |
| III. Test Coverage | PASS | Unit tests for entities (EventSourcedTestKit, KeyValueEntityTestKit). Integration tests for view (Awaitility), endpoints (httpClient), agent (TestModelProvider). |
| IV. Akka SDK Conventions | PASS | All `akka.*` imports. `@Component(id=...)` on all components. No `@Component` on endpoints. `@Acl` on all endpoints. API-specific return types from endpoints. |
| V. Simplicity & Minimalism | PASS | Minimal components needed. No premature abstractions. Cart is KVE (simplest fit). Static HTML for web UI (no frontend framework overhead). |

No violations. Complexity Tracking not needed.

## Project Structure

### Documentation (this feature)

```text
specs/001-pet-store/
├── plan.md              # This file
├── research.md          # Component mapping decisions
├── data-model.md        # Entity schemas and state machines
├── quickstart.md        # curl examples and setup guide
├── contracts/
│   └── http-api.md      # HTTP endpoint contracts
└── tasks.md             # Generated by /speckit.tasks
```

### Source Code (repository root)

```text
src/main/java/com/example/petstore/
├── domain/
│   ├── Pet.java                    # Pet state record + lifecycle logic
│   ├── PetEvent.java               # Sealed event interface
│   ├── ShoppingCart.java           # Cart state record
│   └── Adoption.java              # Adoption state record
├── application/
│   ├── PetEntity.java             # Event Sourced Entity
│   ├── ShoppingCartEntity.java    # Key Value Entity
│   ├── AdoptionWorkflow.java      # Workflow with compensation
│   ├── AvailablePetsBySpeciesView.java  # View (consumes PetEvent)
│   └── PetRecommendationAgent.java     # AI Agent
└── api/
    ├── PetEndpoint.java           # Pet CRUD + catalog
    ├── ShoppingCartEndpoint.java  # Cart operations
    ├── AdoptionEndpoint.java      # Adoption process
    └── PetAssistantEndpoint.java  # AI chat

src/main/resources/
└── application.conf               # Akka + AI model config

src/test/java/com/example/petstore/
├── application/
│   ├── PetEntityTest.java                    # Unit test (EventSourcedTestKit)
│   ├── ShoppingCartEntityTest.java           # Unit test (KeyValueEntityTestKit)
│   └── PetRecommendationAgentIntegrationTest.java  # Agent test (TestModelProvider)
└── api/
    ├── PetEndpointIntegrationTest.java       # httpClient tests
    ├── ShoppingCartEndpointIntegrationTest.java
    ├── AdoptionEndpointIntegrationTest.java
    └── AvailablePetsViewIntegrationTest.java # View + Awaitility
```

**Structure Decision**: Single Akka service project following `domain/application/api` package convention.

## Component Summary

| Component | Type | Akka Pattern | Key Feature |
|-----------|------|-------------|-------------|
| PetEntity | Event Sourced Entity | `EventSourcedEntity<Pet, PetEvent>` | State machine lifecycle |
| ShoppingCartEntity | Key Value Entity | `KeyValueEntity<ShoppingCart>` | Temporary pet selection |
| AdoptionWorkflow | Workflow | `Workflow<Adoption>` | Reserve → Confirm/Cancel with compensation |
| AvailablePetsBySpeciesView | View | `View` + `TableUpdater<PetEntry>` | Query available pets by species |
| PetRecommendationAgent | Agent | `Agent` | LLM chat with inventory tool |
| PetEndpoint | HTTP Endpoint | `@HttpEndpoint("/pets")` | Admin + catalog API |
| ShoppingCartEndpoint | HTTP Endpoint | `@HttpEndpoint("/carts")` | Cart CRUD |
| AdoptionEndpoint | HTTP Endpoint | `@HttpEndpoint("/adoptions")` | Adoption process API |
| PetAssistantEndpoint | HTTP Endpoint | `@HttpEndpoint("/assistant")` | AI chat API |

## Complexity Tracking

> No constitution violations to justify.
